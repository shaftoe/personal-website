{{ $context := .context }}
{{ $sections := where $context.Site.Sections "Params.index_row" .row }}

<nav>
{{ range $section_index, $section := $sections }}

    {{ if isset $section.Params "index_row" }}
    <a href="#{{ anchorize $section.Title }}"{{ if eq $section_index 0 }} class="active"{{ end }}>
        {{ $section.Title }}
    </a>
    {{ end }}

{{ end }}
</nav>

{{ range $section_index, $section := $sections }}
<section id="{{ anchorize $section.Title }}">

    {{ if isset $section.Params "index_row" }}

        {{ range first $context.Site.Params.articles_in_index $section.Pages }}
        {{ $url := or .Params.src_url .RelPermalink }}

        <article>

            {{ if $section.Params.show_title }}
            <h3>
                <a href="{{ $url }}">{{ .Title }}</a>
            </h3>
            {{ end }}

            {{ with .Params.description }}
                {{ . }}
            {{ else }}
                {{ .Content | truncate 380 }}
            {{ end }}

            <a
                href="{{ $url }}"
                {{ if isset .Params "src_url" }}class="extlink"{{ end }}
            >
                {{ partial "date" .Date }}
                {{ if not (isset $section.Params "src_url") }}Read more&#8230;{{end}}
            </a>

        </article>
        {{ end }}

        <a
            href="{{ or .Params.src_url .RelPermalink }}"
            {{ if isset .Params "src_url" }}class="extlink"{{ end }}
        >
            {{ if isset $section.Params "article_kind" }}
                More {{ $section.Params.article_kind | pluralize }}
            {{ else if isset $section.Params "src_url" }}
                More {{ $section.Title | pluralize }}
            {{ else }}
                More articles
            {{end}}
        </a>

    {{ end }}

</section>
{{ end }}